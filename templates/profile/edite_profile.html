{% extends "base.html" %}
{% block title %}Edit Profile{% endblock title %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-6">

      <div class="card shadow-lg border-0">
        <div class="card-body">

          <h3 class="text-center mb-4">Edit Profile</h3>

          <form action="{% url 'profiles:edit_profile' request.user.username %}"
                method="POST"
                enctype="multipart/form-data">

            {% csrf_token %}

            <!-- Avatar -->
            <div class="text-center mb-4">
              <img src="{{ request.user.avatar.url }}"
                   id="avatarPreview"
                   class="rounded-circle mb-2"
                   width="120" height="120"
                   style="object-fit: cover; border: 3px solid #0d6efd;">
              
              <div>
                <label class="btn btn-outline-primary btn-sm">
                  Change avatar
                  <input type="file"
                         name="avatar"
                         accept="image/*"
                         hidden
                         onchange="previewAvatar(event)">
                </label>
              </div>
            </div>

            <!-- Fields -->
{% for field in form.visible_fields %}
  <div class="mb-3">
    {{ field.label_tag }}
    {{ field }}

    {% for error in field.errors %}
      <div class="text-danger small mt-1">
        {{ error }}
      </div>
    {% endfor %}
  </div>
{% endfor %}

            <!-- Actions -->
            <div class="d-grid gap-2 mt-4">
              <button type="submit" class="btn btn-primary">
                Save changes
              </button>
              <a href="{% url 'profiles:profile' request.user.username %}"
                 class="btn btn-outline-secondary">
                Cancel
              </a>
            </div>

          </form>

        </div>
      </div>

    </div>
  </div>
</div>

<script>
function previewAvatar(event) {
  const reader = new FileReader();
  reader.onload = () => {
    document.getElementById('avatarPreview').src = reader.result;
  };
  reader.readAsDataURL(event.target.files[0]);
}
</script>
{% endblock content %}
